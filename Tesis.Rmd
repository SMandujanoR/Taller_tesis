--- 
title: "Manual paquete RAI para calcular la abundancia relativa a partir de foto-trampeo"
author: 
  - "Salvador Mandujano Rodríguez"
  - "Instituto de Ecología A.C." 
  - "Xalapa, Ver., México"
date: "Versión: `r format(Sys.time())`"

output:
    #word_document:
  bookdown::pdf_book:
    includes:
      #in_header: preamble.tex
    keep_tex: yes
    latex_engine: xelatex
    citation_package: natbib

header-includes:
   - \usepackage[utf8]{inputenc}
   - \usepackage[spanish]{babel}
   - \usepackage{fancyhdr}
   - \pagestyle{fancy}
   - \fancyhf{}
   - \fancyhead[LO]{\textit{\small{\nouppercase{\leftmark}}}}
   - \fancyhead[RE]{\textit{\small{\nouppercase{\rightmark}}}}
   - \fancyhead[RO,LE]{\thepage}

fontsize: 11pt
linestretch: 1.1
toc-depth: 1
secnumdepth: 1
lof: True
lot: True
geometry: "left=4cm, right=3cm, top=2.5cm, bottom=2.5cm"

site: bookdown::bookdown_site
documentclass: book

bibliography: biblio.bib 
#biblio-style: apalike
biblio-style: apalike-es
#csl: apa.csl

link-citations: yes
---

# Agradecimientos{-}

El presente trabajo forma parte del proyecto de investigación "*Estimaciones de la ... en la Reserva de Biosfera Tehuacán-Cuicatlán*", financiado por el CONACYT (No. 12345). Agradezco a L.A. Péres-Solano y E. López-Tello algunas sugerencias. La Red de Biología y Conservación de Vertebrados brindó apoyo lógístico.

# Resumen{-}

El presente documento describe paso a paso el empleo del paquete R llamado RAI desarrollado para calcular índices de abundancia relativa (RAI) a partir de una misma base de datos obtenidas durante el fototrampeo. El paquete calcula el RAI de tres maneras: 1) de la forma tradicional donde se agrupan los datos y se obtiene un solo valor por especie, 2) considerando cada cámara como una répicla espacial lo que permite un análisis estadístico más robusto al estimar la variación del índice, y 3) como un modelo lineal generalizado (GLM) tipo regresión Poisson calibrando por el número de días por cámara. El paquete RAI tiene varias funciones que generan tablas, figuras y análisis estadísticos. En este artículo se ejemplifica el empleo de este paquete con un conjunto de datos de un estudio de foto-trampeo en la Reserva de Biósfera Tehuacán-Cuicatlán en Oaxaca, México. Importante: el paquete RAI está disponible libremente.

*Palabras clave*: cámara-trampa, índice abundancia, modelo lineal generalizado, regresión Poisson.

# Introducción

## Aspectos generales

Los índices de abundancia relativa (IAR o también como RAI por sus siglas en inglés) tienen larga tradición en los estudios y monitoreo de fauna silvestre [@Delgado-Martinez2017]; particularmente, para especies raras y/o difíciles de detectar [@Raices2017]. Frecuentemente los RAI son usados como un indicador de la abundancia de la(s) especie(s) en el sitio de estudio [@effects2009]. Algunos RAI clásicos son los basados en las estaciones olfativas [@fegraus2011data], conteo de aves en puntos por unidad de tiempo [@chao2014unifying], conteo de nidos y madrigueras , conteo de huellas a lo largo de caminos, conteo de excrementos en parcelas [@chao2012coverage, @chao2014unifying], conteos de senderos [@hill1973diversity] y otros. En algunos casos, los índices son calibrados o convertidos a densidad poblacional, pero en la mayoría de los casos se emplean solo para un comparación relativa entre especies y para la misma especie en el mismo sitio de estudio o entre sitios [@hsieh2016inext].

## Supuestos de los RAI

El cálculo e interpretación del RAI es relativamente simple: basado únicamente en el valor del índice se determina cuales son las especies “más o menos abundantes” [@mccaffery1976deer]. Esta interpretación es cualitativa y subjetiva pero se reporta en la mayoría de los trabajos como una medida indirecta de la abundancia de cada especie [@sutherland2006ecological]. Sin embargo, esta comparación carece de rigor estadístico por lo que las conclusiones deben tomarse con mucho cuidado [@sutherland2006ecological].

De manera general, estas son algunos de sus supuestos de los RAIs y también de sus limitantes: 
1) Supone una relación lineal positiva entre la abundancia (N) y RAI para la misma para la especie en diferentes localidades y/o estaciones del año, y la misma entre especies.
2) Define la independencia de las fotos de manera arbitraria.
3) Supone constante o similar probabilidad de detección (temporal y espacialmente) para una misma especie y entre especies.
4) No considera ubicación espacial de las cámaras por lo que se pierde información espacial de las especies.
5) No calcula intervalos de confianza de manera que no se puede evaluar el poder estadístico para detectar cambios en las poblaciones.
6) Generalmente se emplean pocas cámaras lo cual puede sesgar la estimación, sobre todo si las cámaras no se colocan de manera aleatoria.
7) Frecuentemente el diseño de muestreo está hecho para una especie en particular, por ejemplo algún depredador, y luego se utilizan todos los datos de las especies obtenidas en las cámaras.
8) Es común poner las cámaras en los senderos y caminos; o bien en sitios seleccionados donde se sabe pasará el animal de interes. También es muy frecuente y discutible el empleo de atrayantes.

## Objetivos de tesis

En este artículo se presenta la aplicación del paquete R llamado `RAI` el cual fue desarrollado para estimar índices de abundancia relativa para diferentes especies mediante el foto-trampeo (Mandujano, *en revisión*). En particular, en este artículo se presenta paso a paso el procedimiento para estimar el RAI considerando tres modelos:
1) RAI tradicional o clásico;
2) RAI alternativo que permite estimar la variación considerando los datos de cada cámara como replicas, y luego compararlos estadísticamente, y
3) RAI como modelo lineal generalizado tipo Poisson con “*offsets*”.

Para este fin, en este artículo se ejemplifica la aplicación de este paquete con un conjunto de datos obtenidos de 13 cámaras en una localidad de estudio en la Reserva de Biósfera Tehuacán-Cuicatlán en Oaxaca, México [@bolker2008ecological; @Moreno2001; @Oksanen2018]. Para detalles de este sitio se sugiere consultar los trabajos de Cruz-Jácome et al. (2014), Mandujano et al. (2016), y el blog <http://venadosrbtc.blogspot.com>.

## Descripción del paquete RAI

El paquete RAI es muy sencillo de aplicar. La idea principal de este paquete es ofrecer a los interesados diferentes funciones para calcular los RAIs para las especies en el sitio de estudio (**Figura 2**). Con este paquete y funciones se generan diferentes tablas de resultados, gráficos y análisis estadísticos. Esto es particularmente importante para aquellas personas con poca o nula experiencia en el empleo de R. El paquete puede decargarse desde: <https://rpubs/SMR8810/RAI.html>. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align = 'center', fig.cap= "Estructura del paquete RAI con las tres opciones de cálculo del índice de abundancia relativa y las funciones asociadas."}
knitr::include_graphics("f1.jpg", dpi = 500 )
```

De manera muy resumida, el paquete `RAI` consiste de tres pasos sencillos:

```
#################################################################
# PASO 1
# Cargar el paquete:
source("RAI.R")
# -----------------------
# PASO 2 
# Leer datos de fototrampeo:
wildlife.data <- read.csv("mamiferos.csv", header = T)
# Leer datos de covariables hábitat:
habitat.data <- read.csv("habitat.csv", header = T)´
# Seleccionar las especies para graficar fotos por cámara, por ejemplo:
especie <- c("Odo_vir", "Uro_cin", "Can_lat", "Con_leu", "Did_vir", "Lyn_ruf")
# -----------------------
# PASO 3
# seleccionar funciones del paquete:
RAIgral() # modelo clásico
RAIalt() # modelo alternativo
Dist_spp() # grafica fotos por cámara y PAO para especies seleccionadas
OccNaive() # proporción de sitios ocupados
RAIaov() # ANOVA 
RAItukey() # prueba post hoc Tukey
RAIhsd() # prueba post hoc HSD
RAIglm() # modelo GLM tipo Poisson
RAIglmCov() # modelo GLM tipo Poisson con covariables
RAIfinal() # tabla de resultados finales
RAIcorr() # grafica comparación RAIs
RAIinterp() # grafica de interpolación 
#################################################################
```

# Ejemplo de aplicación del paquete RAI 

Para ejemplificar el empleo de este paquete, se utilizará un conjunto de datos de 13 especies obtenidos de 13 cámaras en una localidad de estudio en la Reserva de Biósfera Tehuacán-Cuicatlán en Oaxaca, México. Para este fin, se sugiere descargar del sitio <http://RAI> los siguientes tres archivos: `mamiferos.csv`, `habitat.csv` y `pkgRAI_1.R`. Los primeros dos son datos del foto-trampeo y covariables, respectivamente; mientras que el tercero es el paquete `RAI` el cual no requiere instalación. Sin embargo, para su correcta ejecuación se debe cargar primero empleando la función `source`. 

**Importante**. Se sugiere generar un proyecto dentro de `RStudio` y albergar en el mismo estos tres archivos. Los proyectos son una manera muy sencilla y eficaz de organizar y almacener los resultados (gráficos, tablas y otros) generados con este paquete. Un tutorial de cómo generar un proyecto en RStudio puede consultarse en <http://proyectos RStusio>. 

## Cargar el paquete

```{r, message=FALSE, warning=FALSE}
source("pkgRAI_1.R")
```

## Datos de campo

Se sugiere emplear Excel para capturar los datos del foto-trampeo. Esta tabla debe contener 4 columnas cada una con los siguientes nombres: `Camera`, `Species`, `Events` y `Effort`; que corresponden a la cámara-trampa, especie, número de fotos-independientes y número de días de muestreo, respectivamente. **Es muy importante que los nombres de las columnas sean exactamente como aquí se muestran de lo contrario el paquete no funcionará**. Una vez capturados los datos se deben guardar como  archivo tipo `.csv`. Luego en R o `RStudio` se carga el archivo de datos como:

```{r, message=FALSE, warning=FALSE}
wildlife.data <- read.csv("mamiferos.csv", header = T)
attach(wildlife.data)
```

**Tambien es muy importante que el nombre del objeto sea excamente llamado `wildlife.data`**. En este ejemplo específico, los datos están constituidos por el registro de 13 especies de mamíferos medianos y grandes en 13 cámaras trampa durante 250 y 281 días de muestreo en el sitio de estudio (Tabla 1). En R se puede emplear la función `View(wildlife.data)` para observar los datos.

```{r,  echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
knitr::kable(head(wildlife.data, 20), caption = "Datos básicos por especie del número de registros independientes y esfuerzo de muestreo en cada cámara. Aquí se presentan solo los primeros 20 renglones de un total de 117. ")
```

Además de los datos de fotos de las especies en las cámaras, con el paquete RAI es posible incoporar otros datos o covariables en los análisis. Para esto, se introduce una segunda matriz conteniendo los datos de UTMs y covariables de hábitat (y cualquier otra que se requiera), para cada una de las cámaras.

```{r, message=FALSE, warning=FALSE}
habitat.data <- read.csv("habitat.csv", header = T) 
attach(habitat.data)
```

Los datos se muestran en la siguiente Tabla (2). Abreviaciones: distancia a la localidad más cercana (Loc_dist), distancia al camino más cercano (Road_dist), tipo de vegetación (Veg_type), superficie (m2) de arbustos (scrub) y de pastos (grass).

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
knitr::kable(habitat.data, caption = "Datos de UTMs y covariables asociados a cada cámara-trampa. ")
```

Luego, directamente desde el paquete `RAI` se genera una nueva matriz de datos donde se integran los datos `wildlife.data` y `habitat.data` en una sola base como la que se muestra en la **Tabla 3**.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
new.mat <- merge(x = wildlife.data, y = habitat.data, by = "Camera", all = TRUE)
library(kableExtra)
library(xtable)
x <- knitr::kable(head(new.mat, 20), caption = "Datos por especie en cada cámara. Aquí se presentan solo los primeros 20 renglones de un total de 117.", format = "latex", booktabs = TRUE) 
kableExtra::landscape(x)
```

# Modelo clásico o general del RAI

La manera más frecuente para estimar el RAI de cada especie es agrupando la información obtenida en todas las cámaras. Se define un periodo de tiempo en el cual se considera que las fotos de una misma especie son independientes. Habitualmente se emplean dos criterios: 60 min y 1440 min (24h) (@ CITA). Una vez definido esto, se calcula el número de fotos independientes y se divide entre el total de tiempo de muestreo expresado como días o noche-trampa. Frecuentemente, la tasa obtenida se multiplica por 100 o bien por 1000 si el número de registros es demasiado bajo. 

Para calcular el RAI se emplea la fórmula:

$$RAI_{i} = \frac{n_{tot}}{dias_{tot}} \times 100$$ 
**(Eq.1)**

donde: $n_{tot}$ es el número total de registros fotográficos independientes de la *i*-especie, $dias_{tot}$ es el esfuerzo de muestreo o número total de días, y 100 es el factor de corrección estándar. Es decir, el RAI simplemente es un índice que expresa el número promedio de fotos por cada 100 días de muestreo. Asume que a mayor valor del RAI la abundancia de la especie es mayor, pero no lo expresa como número de individuos de la población sino simplemente como un índice (Caugley 1977).

## Empleo del paquete `RAI`

A partir de los datos de la **Tabla 1** y ejectuando la función `RAIgral()`, se cálcula el RAI clásico para cada especie de acuerdo a la **Eq.1** y el paquete genera los resultados automáticamente (**Tabla 4**). A partir de estos resultados en la mayoría de los trabajos se podría concluir que las especies más abundates (mayor RAI) son: *U. cinereoargentus*, *O. virginianus* y *C. latrans*; y todas las demás tiene baja abundancia. Sin embargo, esta conclusión es subjetiva ya que no se basa en ninguna prueba estadística que permita objetivamente sustentar cuáles especies tuvieron RAI distinto y significativo. Para solventar esto el paquete RAI emplea un cálculo del índice alternativo que a continuación se describe.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Tot_cameras <- with(new.mat, length(unique(Camera))) 
  cameras <- with(new.mat, tapply(Camera, Species, length)) 
  days <- with(new.mat, tapply(Effort, Species, sum))   
  n <- with(new.mat, tapply(Events, Species, sum))   
  RAIgral <- round(n/days*100, 2) 
  table.1 <- cbind(cameras, days, n, RAIgral)
  table.1 <- table.1[order(RAIgral),]
  
knitr::kable(table.1, caption = "Estimaciones del índice de abundancia relativa (RAI) estimado con la Ecuación 1 para cada una de las especies.")
```

## Discusión

etc..

# Modelo RAI alternativo

## Heterogeneidad en la distribución de las especies

Al no considerar la ubicación espacial de las cámaras ni las fotos específicas obtenidas por cada una de ellas, en el RAI clásico se pierde o enmascara información relevante relacionada con la distribución espacial de las especies en el área de estudio. El RAI clásico agrupa la información de todas las cámaras, por lo que no es evidente si la especie fue fotografiada en la mayoría o todas las camáras, o si la información proviene solo de algunas cámaras.

Para ejemplificar, en Figura \@ref(fig:f) se muestra el mapa de la localización de varias cámaras en dos sitios de estudio (Pérez-Solano et al. 2018). En cada una de ellas se proporciona información del número de fotos obtenida de las diferentes especies. Es interesante notar la heterogeneidad en la distribución y número de fotos obtenidas de diferentes especies en cada cámara. Por ejemplo, en ambos sitios el número de fotos de coyotes fue alto, pero sin embargo estas fotos solo provienen de 1 ó 2 cámaras. Esto sugiere la posibilidad de que uno o pocos individuos fueron fotografiados constantemente en las cámaras.

```{r f, echo=FALSE, message=FALSE, warning=FALSE, fig.align = 'center', fig.cap= "Distribución de especies fotografiadas en diferentes cámaras-trampa en Actopan, Ver. Basado en Pérez-Solano et al. (2016)."}
knitr::include_graphics("mapaRAI.png", dpi = 250 )
```

Una estadístico alternativo al RAI y que está relacionado con la distribución, es el que se conoce como “ocupación”. Hay modelos para estimar este parámetro, pero uno de los más sencillos es la propoción de sitios ocupados también conocida como “ocupación naive” o bien PAO. Una alternativa más robusta es emplear los modelos que estiman la probabilidad de ocupación (ver **Sección x.x**).

## RAI basado en las cámaras como repeticiones por especie

Una manera muy sencilla de comparar estadísticamente el RAI entre especies en una misma localidad, o de la misma especie en diferentes estaciones y/o localidades diferentes, es calculando el RAI por cámara. Es decir, sin agrupar los datos de todas las cámaras. La fórmula para este caso es:

$$RAI_{ij} = \frac{n_j}{dias_j} \times 100$$ 
**(Eq.2)**

donde: el subíndicie *i* se refiere a cada especie y el subíndice *j* a cada cámara-trampa. Por lo tanto, la **Eq.2** calcula no solo el promedio (el cual sigue siendo el mismo al obtenido en la **Eq.1**) sino además permite estimar alguna medida de la variación, como por ejemplo la desviación o el error estándar lo cual es relevante para comprobar estadísticamente posibels diferencias significativas. 

## Empleo del paquete `RAI`

Para calcular el RAI de acuerdo a la **Eq.2** en la que se obtiene un índice por especie para cada cámara, simplemente se ejecuta la función `RAIalt()` y se obtiene automáticamente la **Tabla 5**.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
 RAIalt <- with(new.mat, round((Events/Effort)*100, 2))
  table.2 <- cbind(new.mat, RAIalt)

knitr::kable(head(table.2[-7:-11], 15), caption = "Matriz de datos con las estimaciones RAI para cada una de las especies. Observe que el RAI es calculado para cada una de las cámaras basado en el número de fotos independientes (en este ejemplo cada 24 h) y el número de días que estuvo activa cada cámara. Aquí se presentan solo los primeros 15 renglones de un total de 117.", format = "latex", booktabs = TRUE) 
#%>% kable_styling(font_size = 7)
#kableExtra::landscape(x)
```

Gráficamente estos resultados se muestran en la **Figura 2**. Atendiendo únicamente al promedio las especies con mayor RAI son: *O. virginianus* y *U. cinereoargenteus*, seguidas de *C. latrans*, *L. rufus* y *N. narica*; mientras que el resto de las especies podrían ser las menos abundantes. Sin embargo, observe las líneas verticales que indican la variación (en este caso desviación estándar) del RAI. Esto se debe a que el RAI se estimó por cámara para cada especie de acuerdo a la **Eq.2**. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 4, fig.cap= "Estimación del índice de abundancia relativa (RAI) para cada especie."}
par(mfcol = c(1,1), mar = c(5,5,1,1))
boxplot(RAIalt ~ Species, data = new.mat, ylab = "RAI", varwidth = F, outline = F, cex = 3.4, las = 2, frame.plot = FALSE, cex.axis = .7, col = "skyblue")
```

## Distribución y ocupación naive por especies/cámara

Resulta muy útil visualizar la distribución de las especies en las diferentes cámaras. Esto permite conocer si los datos de fotografías provienen de todas o solo de algunas cámaras. Para esto, el paquete RAI ofrece la oportunidad de seleccionar las especies que se quieren graficar. Por ejemplo aquí se seleccionan dos especies:

```{r}
especie <- c("Uro_cin", "Can_lat", "Odo_vir", "Syl_flo") 
```

**Nuevamente, es importante que no se modifique el nombre del objeto, es decir `especie`**. Ejecutando la función `Dist_spp( )` se obtiene los gráficos mostrados en la **Figura 3**. En este ejemplo es evidente que *Urocyon cinereoargentus* tiene más amplia distribución y abundancia relativa; mientras que *Canis latrans* aparece en pocas cámaras, aunque con un número grande de fotos en una de ellas. Esto tiene como consecuencia que el RAI de esta especie sea alto (ver **Tabla 4**).

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 4, fig.cap= "Ejemplo de distribución de especies en las cámaras. El número dentro de cada círculo representa el número de fotos. La escala de los ejes está en UTMs."}

par(mfrow=c(2,2), mar= c(3,3,3,3))
  for (i in 1:length(especie)) {
    sp  <- subset(new.mat, Species == especie[i])
    plot(sp$X, sp$Y, xlab="UTM", ylab="UTM", frame.plot = T, cex.axis = 1,  main = unique(sp$Species), type = "n", labels = T, ylim = c(min(sp$Y - 1000), max(sp$Y + 1000)))
    points(sp$X, sp$Y, pch = 16, col = "skyblue", cex = 4)
    text(sp$X, sp$Y, sp$Events)  
  }
```

La proporción de sitios ocupados (PAO) frecuentemente llamada "ocupación naive", es una medida simple de la distribución de cada especie en el sitio de estudio. Se cálcula simplemente como el porcentaje de cámaras donde aparaece la especie de interés. En el paquete `RAI` esto se hace empleando la función `OccNaive()`. Para los ejemplos, se obtiene que *U. cinereoargenteus* tiene una ocupación de 1.0 (100 \%) mientras que *C. latrans* de 0.33 (33 \%) (**Tabla 6**).

```{r, echo=FALSE, message=FALSE, warning=FALSE}
occ <- subset(table.2, table.2$Events > 0)
OccNaive <- as.data.frame(round(table(occ$Species)/cameras,2))
OccNaive <- OccNaive[order(OccNaive$Freq),]
knitr::kable(OccNaive, caption = "Estimaciones de la ocupación naive o proporción de cámaras donde aparece cada especie.")
```

## Comparación estadística entre especies

Para conocer si hay diferencias se puede contrastar estadísticamente los RAI de las especies mediante un análisis de varianza de una vía especificado en R como `lm(RAI ~ Especie)`. Para este fin, la ejecuación del ANOVA se realiza con la función `RAIaov()` y genera la **Tabla 7**.

```{r, echo=FALSE, message=FALSE, warning=FALSE, results= "asis"}
RAIaov <- aov(RAIalt ~ Species-1, data = new.mat)
mod <- summary(RAIaov)
t <- xtable(mod, caption = "Análisis de varianza para comparar el RAI entre especies.")
print.xtable(t, type = "latex", caption.placement = "top")
```

## Comparación posterior: prueba Tukey

De acuerdo a la prueba ANOVA anterior, hay evidencia estadística de que el RAI varía entre especies. Ahora se debe comparar el RAI entre especies para definir cuáles son las diferentes. Esto se puede hace con la prueba *a posteriori* Tukey, con la función `RAItukey()` y se obtiene las comparaciones mostradas en la **Figura 4**.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 6.3, fig.cap= "Comparación posterior de la prueba de Tukey entre el índice de abundancia relativa entre pares de especies."}
par(mfcol = c(1,1), mar = c(2,10,0,1))
plot(TukeyHSD(RAIaov), cex.axis = 0.5, las = 1)
```

Para definir cuales pares de especies son diferentes estadísticamente hablando al comparar sus RAI, se emplea como criterio el valor 0: si la línea horizontal cruza este valor entonces no hay diferencia (P > 0.05); pero si no la cruza y queda del lado derecho o izquierdo del 0, entonces se interpreta como diferencia significativa (P < 0.05). Note en este ejemplo que las comparaciones donde están involucradas *O. virginianus* y *U. cinereoargenteus* son significativas.

## Comparación posterior: prueba HSD

Alternativamente, se puede generar un gráfico empleando, por ejemplo el paquete R llamado `agricolae`; luego se ejecuta la función `RAIhsd()` y se obtiene la **Figura 5**.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.cap= "Comparación posterior de la prueba de HSD."}
  library(agricolae)
  out_1 <- HSD.test(RAIaov, "Species")
  out2 <- out_1$groups
  par(mfcol = c(1,1), mar = c(5,5,1,1))
  bar.group(out_1$groups , horiz = F, las = 2, cex.main = 2, font = 3, cex.axis = 0.9, plot = T, col = "lightblue", ylim = c(0, max(RAIgral + 2)), names.arg = out_1$trt, ylab = "RAI")
```

En este gráfico las letras encima de las barras indican el resultado de la prueba *a posteriori* HSD. Letras similares indican que no existe diferencia entre esas especies (P > 0.05); letras diferentes que sí hay diferencias (P < 0.05). De acuerdo a esto, las dos especies con el RAI mayor fueron *O. virginianus* y *U. cinereoargenteus* (letra "a") y significativamente diferente a las demás (letra "b"). Note que *C. latrans* con un RAI alto, resultó estadísticamente no significativo con el venado y la zorra, pero tampoco con las demás especies con menor RAI. En el caso del coyote esto se debe a que la mayoría de las fotos se detectaron en ua sola cámara, muy probablmente del mismo o pocos individuos (ver **Figura 4**).

## Discusión

etc.

# RAI como modelo lineal generalizado

## GLM tipo regresión Poisson

Otra manera completamente distinta de analizar los datos del foto-trampeo y calcular el RAI, es visualizarlo como un modelo lineal generalizado (GLM, por sus siglas en inglés de *Generalized Lineal Model*). Los GLMs extienden el concepto del efecto lineal de las covariables para los casos donde las variables de respuesta o dependiente no se distribuyen de manera normal (Kéry y Royle 2016). En particular, los GLM son muy útiles para los datos de conteos frecuentemente usados en el trabajo ecológico (Royle y Dorazio 2008). En el caso del foto-trampeo los conteos son el número de fotos independientes por especie en cada cámara. Una consideración importante es que los conteos no se distribuyen de manera normal, por lo que es necesario considerar otras distribuciones estadísticas, como la distribución Poisson (Hines 201x). Entonces el GLM se puede especificar como:

$$n_i \sim Poisson(\lambda_i)$$
$$log(\lambda_i) = \alpha_i + \beta * x$$

donde: $n_i$ es el número de conteos; $\lambda$ (Lambda) es número promedio esperado de conteos; $\alpha$ y $\beta$ son los coeficientes de la regresión, específicamente la ordenada al origen y la pendiente respectivamente; mientras que *x* son la o las covariables o variables predictivas. El símbolo "$\sim$" se lee "*distribuido como*". Un aspecto relevante es que dado que el estimador de lambda está en escala logarítmica, es necesario emplear la función `exp` para linearizar los resultados.

## Incluyendo los “offsets”

Un aspecto frecuentemente observado es que los conteos obtenidos en las unidades de muestreo (cuadrantes, transectos, redes, cámaras, u otro), no siempre provienen de unidades espacial o temporalmente homogéneas; es decir, del mismo tamaño. Por ejemplo, si se tuviera un conteo de 10 y 5 animales en cuadrantes de 500 y 100 m$^2$, respectivamente, entonces no se puede concluir que la abundancia es mayor en el primer cuadrante. En estos casos se puede obtener la densidad de individuos como 10/500= 0.02 ind/m$^2$ y 5/100 = 0.05 ind/m$^2$; es decir, la conclusión cambia radicalmente. De similar forma, si se obtiene un conteo 20 y 8 individuos de la misma especie de ave en parcelas de similar tamaño, pero en una el conteo se hizo en 10 minutos y en la segunda en 5 minutos, no se puede concluir que en la primera parcela hay más aves. Se tiene que calcular la tasa de observación como 20/10 = 2 ind/min y 8/5 = 1.6 ind/min. Es decir, en ambos ejemplos el número de animales observados (contados) fue dependiente del tamaño de la unidad de muestreo o del tiempo invertido en la unidad de muestreo.

En el caso del RAI la tasa de observación se expresa como número de fotos “promedio” por cámara por 100 días (O’Conell 201x). Esto se calcula así debido a que frecuentemente el número de días de muestreo no es el mismo para todas las cámaras, durante todo el muestreo y en todas las localidades (suponiendo que hay más de una). Si este número de días fuera exactamente el mismo para todas las cámaras, entonces se podría emplear simplemente el número de fotos como un indicador de la abundancia sin necesidad de calcular el RAI (X et al. 2013).

Sin embargo, cuando se tiene distinto número de días, se pueden incluir direcatmente en el análisis. Una manera apropiada para incorporar en los GLMs conteos provenientes de unidades de muestreo con diferente tamaño o esfuerzo de muestreo (días), es considerar lo que se conoce como “offsets” que pudiera ser traducido como “calibración”.

## RAI como modelo GLM Poisson

Un GLM tipo Poisson donde se incorpora esta heterogeneidad en los días de muestreo en la *i*-cámara puede escribirse como:

$$n_{ij} \sim Poisson(Dias_i * \lambda_i)$$
$$log(Dias_i * \lambda_i) = \alpha_j + 1 * log(Dias_i) + \beta * x$$
**(Eq.3)**

donde *j* respresenta cada especie animal. Además, *x* podría ser cualquier característica o covariable que se considere afecta o se relaciona con el RAI de cada especie. Un aspecto a destacar del modelo de la **Eq.3** es que el coeficiente $\alpha$ es el RAI cuando $\beta * x = 0$, es decir cuando no se incluyen covariables. Esto permite calcular el RAI de una manera alternativa y sencilla especificado como GLM. Además, cuando se consideran covariables el RAI se calcula para cada factor (por ejemplo tipo de hábitat) y/o su relación con variables continuas (por ejemplo pensiente, distancia a fuentes de agua, etc.). Esto se ejemplificara más adelante (**Sección x.x**). 

## Empleo del paquete `RAI`

Como se describió en la **sección 3.3**, una manera completamente diferente de calcular el RAI es empleando un enfoque de modelos lineales generalizados (GLMs). A partir de la matriz donde se incluyen los datos por especie y cámara (ver **Tabla 5**), se calcula el RAI para cada especie basado en la regresión tipo Poisson de la *Eq.3* empleando la función `RAIglm()`. En R este GLM se específica como `RAIglm <- glm(Events ~ Species-1, data = new.mat, offset = log(Effort), family = quasipoisson)`. De acuerdo a esto se obtiene:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
RAIglm <- glm(Events ~ Species-1, data = new.mat, offset = log(Effort), family = quasipoisson)
summary(RAIglm)
#t <- xtable(RAIglm, caption = "Coeficientes del modelo lineal generalizado tipo regresión Poisson.")
#print.xtable(t, caption.placement = "top")
```

En un GLM Poisson los coeficientes de regresión están expresados en escala logarítimica, esto se observa en la columna `Estimate`. Para linearizarlos se debe aplicar una transformación exponencial empleando el siguiente código: `RAIpoisson <- exp(RAIglm$coefficients)`. Multiplicando esto por 100 se obtiene como resultado exactamente el mismo RAI calculado con el modelo clásico de la **Eq.1**: 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
(RAIpoisson <- round(exp(RAIglm$coefficients)*100, 2))
```

Es decir, empleando un GLM Poisson se puede calcular de manera muy sencilla y más rápida los RAI.

## Regresión Poisson con covariables

Calcular el RAI por sí mismo es de poca importancia ecológica ya que el número crudo no permite conocer las posibles causas o factores asociados que pudieran estar afectando el tamaño de una población en determinado momento en el sitio de estudio (@CITA). En el trabajo ecológico resulta más interesante es tratar de explicar este RAI relacionando con variables del hábitat, humanas, climáticas. Esto se puede lograr si en el modelo se emplean covariables. 

Por ejemplo, en el siguiente GLM se analizan los datos específicos de la especie *U. cinereoargentus* (**Tabla 8**). Luego se procede a ejecutar el GLM Poisson con covariables. :
 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
especie_sel <- table.2[table.2$Species== "Uro_cin",]
especie_sel <- especie_sel[-10:-13,]
knitr::kable(especie_sel[-6:-7], caption = "Datos específicos de la especie seleccionada.", digits = 0, format = "latex", booktabs = TRUE) %>% kable_styling(font_size = 7)
#kableExtra::landscape(x)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
RAIglm2 <- glm(Events ~ Veg_type-1, data = especie_sel, offset = log(Effort), family = quasipoisson) 
summary(RAIglm2)
#xtable(mod, caption = "Análisi.....")
```

Nuevamente, los coeficientos de regresión en un GLM deben linearizarse, en este caso usando la función `exp()` al tratarse desde una distribución Poisson. Para este ejemplo se tiene la estimación del RAI para cada tipo de vegetación (**Figura 7**).

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 3, fig.cap= "Comparación del RAI entre tipos de vegetación de la especie seleccionada."}
(RAIglm2 <- exp(RAIglm2$coefficients)*100)
par(mfcol = c(1,1), mar = c(5,5,1,1))
plot(RAIalt ~ Veg_type, data = especie_sel, frame.plot = F, varwidth = T, col = "skyblue", main = unique(especie_sel$Species))
```

Otra hipótesis a contrastar podría ser si el RAI de la especie está relacionada con la superficie del tipo de hábitat dominado por arbustivas o el de pastos (**Figura 8**).

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 3, fig.cap= "Comparación del RAI en relación a la cobertura de arbustos y pastos."}
RAIglm3 <- glm(Events ~ scrub + grass, data = especie_sel, offset = log(Effort), family = quasipoisson) 
summary(RAIglm3)

par(mfcol = c(1,2), mar = c(5,5,1,1))
plot(RAIalt ~ scrub, data = especie_sel, frame.plot = F, col = "skyblue", las = 1, pch = 16, cex = 2)
plot(RAIalt ~ grass, data = especie_sel, frame.plot = F, col = "skyblue", las = 1, pch = 16, cex = 2)
```

Alternativamente, se puede probar la hipótesis si el RAI está asociado con las distancias a los caminos o a las localidades más cercanas (**Figura 9**).

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 3, fig.cap= "Comparación del RAI en relación a la distancia a caminos y poblados."}
RAIglm3 <- glm(Events ~ Road_dist + Loc_dist, data = especie_sel, offset = log(Effort), family = quasipoisson) 
summary(RAIglm3)

par(mfcol = c(1,2), mar = c(5,5,1,1))
plot(RAIalt ~ Road_dist, data = especie_sel, frame.plot = F, col = "skyblue", las = 1, pch = 16, cex = 2)
plot(RAIalt ~ Loc_dist, data = especie_sel, frame.plot = F, col = "skyblue", las = 1, pch = 16, cex = 2)
```

# Resumen final

## Tabla de resultados

El paquete RAI tiene la función `RAIfinal()` la cual genera la **Tabla 9** con los resultados del RAI obtenidos para cada especie y modelo.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
RAImean <- with(new.mat, round(tapply(RAIalt, Species, mean), 2))
  RAIsd <- with(new.mat, round(tapply(RAIalt, Species, sd), 2))
  occ <- subset(table.2, table.2$Events > 0)
  OccNaive <- round(table(occ$Species)/cameras,2)

table.3 <- cbind(cameras, days, n, RAIgral, RAImean, RAIsd, RAIpoisson, OccNaive)
table.3 <- table.3[order(RAIgral),]

knitr::kable(table.3, caption = "Resumen final de los resultados de los RAI obtenidos con los diferentes modelos para cada especie en la localidad de estudio.", digits = 2)
```

## Discusión

etc.

## Relación entre índices

En este artículo se ha demostrado que el RAI obtenido de la manera habitual con la **Eq.1** muy similar al RAI promedio obtenido con la **Eq.2**. Además, que el RAI se obtenido como GLM con la **Eq.3** es el mismo al RAI clásico. Esto se comprueba gráficamente estimando el coeficiente de correlación empleando la función `RAIcorr()` lo cual produce las siguientes gráficas:

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 4, fig.cap= "Relación entre los índices."}
r1 <- round(cor(RAIgral, RAImean),2)
r2 <- round(cor(RAIgral, OccNaive),2)

  par(mfcol = c(1,2), mar = c(5,5,5,1))
  plot(RAIgral, RAImean, frame.plot = F, las = 1, pch = 16, col = "skyblue", ylab = "RAI alternativo", xlab = "RAI general", cex = 2, cex.main = 0.7)
  abline(lm(RAImean ~ RAIgral), col = "red")
  text(2,7, as.expression(substitute(r == r1, list(r1 = r1))))

  plot(RAImean, as.numeric(OccNaive), ylab= "Occupation naive", xlab = "RAI alternativo", frame.plot = F, las = 1, pch = 16, col = "skyblue", cex = 2)
  abline(lm(OccNaive ~ RAImean), col = "red")
  text(2,0.9, as.expression(substitute(r == r2, list(r2 = r2))))
```

La diferencia esencial es que con el procedimiento de la **Eq.2** podemos analizar cuantitativamente el índice para probar posibles diferencias estadísticamente significativas. Por otro lado, para probar si el RAI está relacionado con la ocupación, nuevamente podemos graficar y/o calcular el coeficiente correlación entre ambas variables. Como se aprecia, la ocupación y el RAI no necesariamente están correlacionados. Esto refuerza la importancia de calcular el RAI por cámara.

## Análisis de interpolación

Otra manera interesante de presentar los resultados relacionando el IAR_promedio con la ocupación naive por especie, se muestra en el siguiente código el cual se basa en un análisis sencillos de interpolación de datos. Se cargan directamente desde RAI las siguientes paqueterías `akima`, `MASS`y `RColorBrewer`, y se ejecuta la función `RAIinterp()` la cual arroja la **Figura 10**.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 5, fig.cap= "Interpolación entre...."}
  library(akima)
  library (MASS)
  library(RColorBrewer)
  par(mfrow = c(1,1))
  g <- interp(RAImean, OccNaive, n, duplicate = T)
  image(g, col= topo.colors(12), cex.lab = 1.0, frame = F, xlab= "RAI_alt", ylab = "Occupation naive", xlim = c(0, max(RAImean + 2)), ylim = c(0, 1.1))
  contour(g, add = T)
  text(RAImean, jitter(OccNaive,3), labels = unique(sort(new.mat$Species)), cex = 1, pos = 4, col = "red")
```

En esta gráfica se muestra que a medida que aumenta el valor promedio del RAI la ocupación de las especies aumenta de forma linear. Pero en el caso de las especies con muy bajo RAI, se puede observar que la ocupación puede ser diferente. Esto es importante de notar y es el resultado de la heterogeneidad en la distribución de las especies en el sitio de estudio. Es decir, el RAI no solo es producto del número de fotos de cada especie, sino además del número de sitios (cámaras) donde se obtuvieron estas fotos.

## Importancia de la probabilidad de detección

De manera implícita el RAI se basa en un supuesto débil: la probabilidad de detección es la misma para todas las especies, o para la misma especie en diferentes épocas del año y localidades. Es decir, la probabilidad de detección no es considerada en la estimación del RAI. De manera implícita el RAI asume estos supuestos:

1) Los valores de 0 indican ausencia real de la especie; es decir, la probabilidad de detección es exactamente igual a 1.
2) Entre especies, la probabilidad de detección es la misma para todas.
3) Para una misma especie, la probalidad de detección es la misma entre tipos de hábitats y entre temporadas del año.

A partir de la experiencia en el trabajo de campo, se sabe que un 0 no significa necesariamente que la especie no está presente (Rovero y 201x). Es posible que la especie habite la localidad de estudio y sin embargo no fue fotografiada o detectada en las cámaras. Esto es lo que se conoce como falso negativo o un falso cero (CITA). Los RAI no están diseñados para estimar ni incorporar los falsos negativos.

Para este fin afortunadamente existe otra familia de modelos los cuales estiman tanto la probabilidad de detección como la de ocupación (CITA). Estos modelos son más robustos que los RAI pero requieren de comprender el enfoque jerárquico de análisis en ecología (Royle y ). El programa PRESENCE (CITA) y el paquete R `unmarked` (CITA), abordan este aspecto con mayor profundidad y solidez analítica este tipo de modelos. No es objetivo del presente trabajo profundizar. . . **COMPLETAR IDEA**

# Conclusiones

En este artículo se presentan diferentes modelos para estimar el índice de abundancia relativa (RAI). El proceso descrito en este artículo permite de manera muy sencilla mejorar la interpretación y conslusiones del RAI basado en criterios estadísticos sencillos, pero más robusto. 

Sin embargo, este proceso no soluciona el punto más crítico y controversial de los RAI: el supuesto falso de que la probabilidad de detección es similar para una misma especie entre hábitats y periodos, y entre diferentes especies en una misma localidad. La sugerencia es por lo menos calcular el llamado índice de ocupación naive o proporción de sitios ocupados (PAO) el cual provee de información espacial elemental en la variación de la abundancia de cada especie en el sitio de estudio.

Alternativamente, con el foto-trampeo se pueden emplear otros modelos con mayor sustento teórico: modelos de ocupación, modelos N-mixtos, modelos de captura-recaptura simples o espacialmente explícitos (Kéry y Royle 2016). Lo único que se requiere es conocer estos modelos opcionales, ya que la base de información se tiene con el mismo foto-trampeo. Simplemente se debe organizar los datos de otra manera (nada complicada) y considerar además la ubicación espacial de cada cámara. 
